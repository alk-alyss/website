{{> header}}

<hr class="box-shadow">

{{!-- carousel --}}


{{!-- <main> --}}
    <div class="path_container">
        <a href="/">
        <img src="/icons/back_arrow.svg">
        <p>Λίστα Αγγελιών</p>
        </a>

        {{!-- path taken --}}
        <div class="path">
            <p> <a>Αρχική <img src="/icons/chevron-right.svg"> </a> <a>Λίστα Αγγελιών <img src="/icons/path.svg"> </a></p>

        </div>
    </div>

    <div class="listing_container">
        <div class="listing_images"  onclick="openCarousel()">
            {{!-- might be replaced with carousel --}}
            <div class="big_image">
                <img id="1" src="{{listing.images.[0]}}">
            </div>
            <div class="small_images">
                {{#each listing.images}}
                    <img id="{{@index}}" src="{{this}}">
                {{/each}}
            </div>

        </div>

        <div class="listing">
            <div class="listing_info">
                <div class="listing_title">
                    <h2>Τίτλος Αγγελίας</h2>
                    <p>Υποπεριοχή</p>
                </div>

                <div class="listing_phone">
                    <button>Τηλέφωνο Επικοινωνίας</button>
                </div>
            </div>

            <div class="attributes">
                <div class="listing_details">
                    <div class="listing_location">
                        <p>Ακριβής τοποθεσία</p>
                    </div>

                    <div class="listing_price">
                        <p>€ {{listing.price}} </p>
                        <div class="heart">{{> heart}}</div>
                    </div>

                    <div class="listing_description">
                        <p>1 όροφος</p>
                        <p>1 υ/δ</p>
                        <p>1 μπ</p>
                    </div>

                    <label class="extra_characteristics" for="listing_extra_characteristics">Ειδικά χαρακτηριστικά</label>
                    <div class="listing_extra_characteristics">
                        <p>special 1</p>
                        <p>special 2</p>
                        <p>special 3</p>
                        <p>special 1</p>
                        <p>special 2</p>
                        <p>special 3</p>
                        <p>special 1</p>
                        <p>special 2</p>
                        <p>special 3</p>
                    </div>
                </div>

                <div class="char_div">
                    <label class="characteristics" for="listing_characteristics">Χαρακτηριστικά</label>
                    <div class="listing_characteristics">
                        <table>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                            <tr> <td style="background-color: #F0F0F0">Characteristic</td> <td>Value</td> </tr>
                        </table>
                    </div>
                </div>
            </div>
{{!-- </main> --}}

    <hr class="divider">


    <div class="listing_owner">
        <div class="provider_logo">
                <label class="provider" for="provider_logo">Πληροφορίες Αγγελιοδότη</label>
                <img src="/icons/provider.svg">
            </div>
            
            
            <div class="provider_contact">
                <label for="provider_name">Όνομα</label>
                <p> (phone number) </p>
            </div>
    </div>

    <div class="myCarousel">
        <a id="clsbtn">&times;</a>

        <div id="carousel_slide">
            <div class="carousel_inner">
                {{#each listing.images}}
                <div class="item" active_image"">
                    <img id="{{@index}}" src="{{this}}">
                </div>
                {{/each}}
            </div>
            <a class="carousel-control-prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
    </div>
    

<script>
    let carousel = document.querySelector(".myCarousel")

    let next = document.querySelector(".carousel-control-next")
    let prev = document.querySelector(".carousel-control-prev")
    let slide = document.querySelector(".carousel_inner")
    let item = document.querySelector(".item")
    let close = document.getElementById("clsbtn")
    let items = document.querySelectorAll(".item")
    
    currentSlide = 0
    items[currentSlide].classList.add("active_image")

    // when trigger clicked open carousel
    function openCarousel() {
        //set carousel opacity to 1
        carousel.classList.add("active")
        console.log("opened")
    }
    
    function closeCarousel() {
        
        carousel.classList.remove("active")
    }

    function nextSlide(currentSlide) {
        items.forEach(item => {
            item.classList.remove("active_image")
        })
        
        items[currentSlide].classList.add("active_image")
        console.log("got here")
    }

    function prevSlide(currentSlide) {
        items.forEach(item => {
            item.classList.remove("active_image")
        })
        items[currentSlide].classList.add("active_image")
    }

    next.addEventListener("click", () => {
        currentSlide++
        if (currentSlide >= items.length) {
            currentSlide = 0
            console.log(currentSlide)
        }
        console.log(currentSlide)
        nextSlide(currentSlide)
    })

    prev.addEventListener("click", () => {
        currentSlide--
        if (currentSlide <= 0) {
            currentSlide = items.length - 1
        }
        prevSlide(currentSlide)
    })

    close.addEventListener("click", function (){
        closeCarousel();
    })

    //keyboard escape event listener
    document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") {
            closeCarousel()
        }
    })

    //event listener on keydown next and prev
    document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight") {
            currentSlide++
            if (currentSlide >= items.length) {
                currentSlide = 0
                console.log(currentSlide)
            }
            console.log(currentSlide)
            nextSlide(currentSlide)
        }
    })

    document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") {
            currentSlide--
            if (currentSlide <= 0) {
                currentSlide = items.length - 1
            }
            prevSlide(currentSlide)
        }
    })


</script>